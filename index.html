<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>달의 모양 관찰하기</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>달의 모양 관찰하기</h1>
        </div>

        <div class="controls">
            <input type="date" id="dateSelector" class="date-input">
            <button id="viewToggle" class="button">월간 보기</button>
        </div>

        <div id="dailyView" class="moon-display">
            <svg id="moonSVG" class="moon-svg moon-glow" viewBox="0 0 100 100"></svg>
            <div class="info">
                <h2 id="phaseText"></h2>
                <p id="dateText"></p>
                <div id="moonMeaning" class="moon-meaning"></div>
            </div>
        </div>

        <div class="location-info">
            <h3>관측 정보</h3>
            <div id="locationStatus">위치 정보를 가져오는 중...</div>

            <div class="observation-grid">
                <div class="info-card">
                    <h3>달 출몰 시간</h3>
                    <div id="moonTimes"></div>
                </div>

                <div class="info-card">
                    <h3>현재 달 위치</h3>
                    <div id="moonPosition"></div>
                    <div class="compass" id="moonCompass">
                        <div class="compass-marker" id="moonMarker"></div>
                        <div id="compassDirections"></div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>관측 조건</h3>
                    <div id="observationConditions"></div>
                </div>
            </div>
        </div>

        <div id="monthView" class="month-view" style="display: none"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
    <script>
        function getMoonPhase(date) {
            const moonIllum = SunCalc.getMoonIllumination(date);
            return {
                phase: moonIllum.phase * 100,
                angle: moonIllum.angle,
                fraction: moonIllum.fraction
            };
        }

        function getMoonPhaseInfo(phase) {
            if (phase < 1 || phase > 99) return { name: "삭 (New Moon)", meaning: "달이 보이지 않는 시기입니다." };
            if (phase < 7) return { name: "초승달 🌒", meaning: "작은 빛이 오른쪽에 나타납니다." };
            if (phase < 23) return { name: "증대 초승달", meaning: "달의 오른쪽이 점점 밝아집니다." };
            if (phase < 27) return { name: "상현달 🌓", meaning: "달의 오른쪽이 반쯤 밝습니다." };
            if (phase < 48) return { name: "상현 이후", meaning: "달이 점점 더 차오릅니다." };
            if (phase < 52) return { name: "보름달 🌕", meaning: "달이 완전히 밝습니다." };
            if (phase < 73) return { name: "기울어가는 달", meaning: "달의 왼쪽이 서서히 어두워집니다." };
            if (phase < 77) return { name: "하현달 🌗", meaning: "달의 왼쪽이 반쯤 밝습니다." };
            if (phase < 93) return { name: "기울어가는 초승달", meaning: "달의 밝은 부분이 점점 사라집니다." };
            return { name: "그믐달 🌘", meaning: "왼쪽에 작은 빛이 남아있습니다." };
        }

        function updateUI(date) {
            const moon = getMoonPhase(date);
            const info = getMoonPhaseInfo(moon.phase);

            document.getElementById("phaseText").textContent = info.name;
            document.getElementById("moonMeaning").textContent = info.meaning;
            document.getElementById("dateText").textContent = date.toLocaleDateString('ko-KR');

            document.getElementById("moonSVG").innerHTML = `<circle cx="50" cy="50" r="40" fill="white" opacity="${moon.fraction}" />`;
        }

        document.getElementById("dateSelector").addEventListener("change", (e) => {
            const selectedDate = new Date(e.target.value);
            updateUI(selectedDate);
        });

        document.addEventListener("DOMContentLoaded", () => {
            const today = new Date();
            document.getElementById("dateSelector").valueAsDate = today;
            updateUI(today);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    document.getElementById("locationStatus").textContent = `현재 위치: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                });
            }
        });
    </script>
</body>
</html>
