<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 달</title>
    <style>
        body {
            margin: 0;
            background: #000;
            color: #fff;
            font-family: 'Apple SD Gothic Neo', 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        h1 {
            font-size: 2rem;
            color: #FFD700;
            margin-bottom: 20px;
        }
        .moon-svg {
            width: 200px;
            height: 200px;
            background: transparent;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 12px #FDB813);
        }
        .info {
            font-size: 1rem;
            text-align: center;
            line-height: 1.6;
        }
        .highlight {
            color: #FFD700;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>🌙 오늘의 달</h1>
    <svg id="moonSVG" class="moon-svg" viewBox="0 0 100 100"></svg>
    <div class="info" id="moonInfo"></div>
    <button onclick="init()">다시 계산</button>

    <script>
        function getJulianDate(date) {
            const time = date.getTime();
            const tzoffset = date.getTimezoneOffset();
            return (time / 86400000) - (tzoffset / 1440) + 2440587.5;
        }

        function getMoonPhase(date) {
            const JD = getJulianDate(date);
            const days = JD - 2451545.0;
            const lunations = 29.530588861;
            let phase = ((days % lunations) / lunations) * 100;
            if (phase < 0) phase += 100;
            return phase;
        }

        function createMoonSVG(phase) {
            const cx = 50, cy = 50, r = 48;
            let d = '';
            let svgContent = '';
            
            if (phase < 1 || phase > 99) {
                svgContent = `<circle cx="${cx}" cy="${cy}" r="${r}" fill="black" stroke="#FDB813" stroke-width="1"/>`;
            } else {
                const fade = phase > 50 ? (100 - phase) / 50 : phase / 50;
                if (phase <= 50) {
                    d = `M ${cx} ${cy - r}
                         A ${r} ${r} 0 1 1 ${cx} ${cy + r}
                         A ${r * fade} ${r} 0 0 0 ${cx} ${cy - r}`;
                } else {
                    d = `M ${cx} ${cy - r}
                         A ${r} ${r} 0 1 0 ${cx} ${cy + r}
                         A ${r * fade} ${r} 0 0 1 ${cx} ${cy - r}`;
                }
                svgContent = `
                <defs>
                    <radialGradient id="moonGlow" r="75%" cx="50%" cy="50%">
                        <stop offset="0%" stop-color="#FDB813" />
                        <stop offset="100%" stop-color="black" stop-opacity="0" />
                    </radialGradient>
                </defs>
                <circle cx="${cx}" cy="${cy}" r="${r}" fill="url(#moonGlow)" />
                <path d="${d}" fill="#FDB813" />`;
            }

            console.log("SVG Content:", svgContent); // 확인용 로그
            document.getElementById('moonSVG').innerHTML = svgContent; // 삽입 확인
        }

        function updateInfo(phase) {
            let name = '', meaning = '';
            if (phase < 1 || phase > 99) {
                name = "삭"; meaning = "새로운 시작을 준비할 때입니다.";
            } else if (phase < 15) {
                name = "초승달"; meaning = "기회의 씨앗이 자라납니다.";
            } else if (phase < 35) {
                name = "상현달"; meaning = "긍정적인 에너지가 가득합니다.";
            } else if (phase < 45) {
                name = "만상"; meaning = "기대감이 커지는 시기입니다.";
            } else if (phase <= 55) {
                name = "보름달"; meaning = "풍요와 충만함이 느껴집니다.";
            } else if (phase < 65) {
                name = "만하"; meaning = "감사함을 느껴보세요.";
            } else if (phase < 85) {
                name = "하현달"; meaning = "지나온 날들을 돌아보세요.";
            } else {
                name = "그믐달"; meaning = "마무리와 정리의 시간을 가지세요.";
            }

            document.getElementById('moonInfo').innerHTML = 
                `<div><span class="highlight">위상:</span> ${phase.toFixed(1)}%</div>
                 <div><span class="highlight">설명:</span> 🌑 ${name} - ${meaning}</div>`;
        }

        function init() {
            const today = new Date();
            const phase = getMoonPhase(today);
            createMoonSVG(phase);
            updateInfo(phase);
        }

        init();
    </script>
</body>
</html>
