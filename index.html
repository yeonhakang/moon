<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¬ì˜ ëª¨ì–‘ ê´€ì°°í•˜ê¸°</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Noto Sans KR', sans-serif;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-top: 1em;
      color: #ffe082;
    }

    .moon-img {
      width: 200px;
      height: 200px;
      margin: 1em auto;
      border-radius: 50%;
      box-shadow: 0 0 30px 10px rgba(255, 255, 0, 0.5);
      background-size: cover;
      background-position: center;
    }

    .info {
      font-size: 1.2em;
      margin: 1em;
    }

    .info strong {
      color: #ffee58;
    }

    .month-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      padding: 1em;
    }

    .day-cell {
      background-color: #111;
      border: 1px solid #333;
      padding: 0.5em;
      border-radius: 10px;
    }

    .day-cell img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
    }

    .desc {
      font-size: 0.85em;
      color: #ccc;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      .moon-img {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸŒ™ ì˜¤ëŠ˜ì˜ ë‹¬</h1>
  <div id="moonPhaseImg" class="moon-img"></div>
  <div class="info">
    <div><strong>ìœ„ìƒ:</strong> <span id="illumination"></span>%</div>
    <div><strong>ë°©í–¥:</strong> <span id="azimuth"></span>Â°</div>
    <div><strong>ê³ ë„:</strong> <span id="altitude"></span>Â°</div>
    <div><strong>ì¶œ:</strong> <span id="rise"></span> / <strong>ëª°:</strong> <span id="set"></span></div>
    <div><strong>ì„¤ëª…:</strong> <span id="description"></span></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
  <script>
    const moonPhaseImg = document.getElementById('moonPhaseImg');

    function getPhaseDescription(fraction) {
      if (fraction < 0.03) return 'ğŸŒ‘ ì‚­ - ìƒˆë¡œìš´ ì‹œì‘ì˜ ì–´ë‘ ';
      if (fraction < 0.25) return 'ğŸŒ’ ì´ˆìŠ¹ë‹¬ - ê¸°íšŒì˜ ì”¨ì•—ì´ ìë¼ë‚©ë‹ˆë‹¤';
      if (fraction < 0.5) return 'ğŸŒ“ ìƒí˜„ë‹¬ - ë„ì „ì˜ ì‹œê¸°';
      if (fraction < 0.75) return 'ğŸŒ” ë³´ë¦„ë‹¬ - ì„±ì·¨ì™€ ê°ì‚¬';
      if (fraction < 0.97) return 'ğŸŒ— í•˜í˜„ë‹¬ - ëŒì•„ë´„ê³¼ ë°˜ì„±';
      return 'ğŸŒ‘ ê·¸ë¯ë‹¬ - ëê³¼ ìƒˆë¡œìš´ ì‹œì‘ì˜ ì¤€ë¹„';
    }

    function getMoonImage(fraction, phase) {
      const index = Math.round(fraction * 29.5);
      return `https://svs.gsfc.nasa.gov/vis/a000000/a005400/a005415/frames/1920x1080_1x1_30fps/moon.${String(index).padStart(2, '0')}.jpg`;
    }

    function updateMoonData(position) {
      const now = new Date();
      const moonPos = SunCalc.getMoonPosition(now, position.coords.latitude, position.coords.longitude);
      const moonIllum = SunCalc.getMoonIllumination(now);
      const moonTimes = SunCalc.getMoonTimes(now, position.coords.latitude, position.coords.longitude);

      const illumination = (moonIllum.fraction * 100).toFixed(1);
      const phaseDesc = getPhaseDescription(moonIllum.fraction);
      const moonImg = getMoonImage(moonIllum.fraction, moonIllum.phase);

      moonPhaseImg.style.backgroundImage = `url(${moonImg})`;
      document.getElementById('illumination').textContent = illumination;
      document.getElementById('azimuth').textContent = (moonPos.azimuth * 180 / Math.PI).toFixed(1);
      document.getElementById('altitude').textContent = (moonPos.altitude * 180 / Math.PI).toFixed(1);
      document.getElementById('rise').textContent = moonTimes.rise?.toLocaleTimeString('ko-KR') || 'ì—†ìŒ';
      document.getElementById('set').textContent = moonTimes.set?.toLocaleTimeString('ko-KR') || 'ì—†ìŒ';
      document.getElementById('description').textContent = phaseDesc;
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(updateMoonData, () => {
        alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      });
    } else {
      alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }
  </script>
</body>
</html>
