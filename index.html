<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>달의 모양 관찰하기</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Noto Sans KR', sans-serif;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-top: 1em;
      color: #ffe082;
    }

    .moon-img {
      width: 200px;
      height: 200px;
      margin: 1em auto;
      border-radius: 50%;
      box-shadow: 0 0 30px 10px rgba(255, 255, 0, 0.5);
      background-size: cover;
      background-position: center;
    }

    .info {
      font-size: 1.2em;
      margin: 1em;
    }

    .info strong {
      color: #ffee58;
    }

    .month-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      padding: 1em;
    }

    .day-cell {
      background-color: #111;
      border: 1px solid #333;
      padding: 0.5em;
      border-radius: 10px;
    }

    .day-cell img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
    }

    .desc {
      font-size: 0.85em;
      color: #ccc;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      .moon-img {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <h1>🌙 오늘의 달</h1>
  <div id="moonPhaseImg" class="moon-img"></div>
  <div class="info">
    <div><strong>위상:</strong> <span id="illumination"></span>%</div>
    <div><strong>방향:</strong> <span id="azimuth"></span>°</div>
    <div><strong>고도:</strong> <span id="altitude"></span>°</div>
    <div><strong>출:</strong> <span id="rise"></span> / <strong>몰:</strong> <span id="set"></span></div>
    <div><strong>설명:</strong> <span id="description"></span></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
  <script>
    const moonPhaseImg = document.getElementById('moonPhaseImg');

    function getPhaseDescription(fraction) {
      if (fraction < 0.03) return '🌑 삭 - 새로운 시작의 어둠';
      if (fraction < 0.25) return '🌒 초승달 - 기회의 씨앗이 자라납니다';
      if (fraction < 0.5) return '🌓 상현달 - 도전의 시기';
      if (fraction < 0.75) return '🌔 보름달 - 성취와 감사';
      if (fraction < 0.97) return '🌗 하현달 - 돌아봄과 반성';
      return '🌑 그믐달 - 끝과 새로운 시작의 준비';
    }

    function getMoonImage(fraction, phase) {
      const index = Math.round(fraction * 29.5);
      return `https://svs.gsfc.nasa.gov/vis/a000000/a005400/a005415/frames/1920x1080_1x1_30fps/moon.${String(index).padStart(2, '0')}.jpg`;
    }

    function updateMoonData(position) {
      const now = new Date();
      const moonPos = SunCalc.getMoonPosition(now, position.coords.latitude, position.coords.longitude);
      const moonIllum = SunCalc.getMoonIllumination(now);
      const moonTimes = SunCalc.getMoonTimes(now, position.coords.latitude, position.coords.longitude);

      const illumination = (moonIllum.fraction * 100).toFixed(1);
      const phaseDesc = getPhaseDescription(moonIllum.fraction);
      const moonImg = getMoonImage(moonIllum.fraction, moonIllum.phase);

      moonPhaseImg.style.backgroundImage = `url(${moonImg})`;
      document.getElementById('illumination').textContent = illumination;
      document.getElementById('azimuth').textContent = (moonPos.azimuth * 180 / Math.PI).toFixed(1);
      document.getElementById('altitude').textContent = (moonPos.altitude * 180 / Math.PI).toFixed(1);
      document.getElementById('rise').textContent = moonTimes.rise?.toLocaleTimeString('ko-KR') || '없음';
      document.getElementById('set').textContent = moonTimes.set?.toLocaleTimeString('ko-KR') || '없음';
      document.getElementById('description').textContent = phaseDesc;
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(updateMoonData, () => {
        alert('위치 정보를 가져올 수 없습니다.');
      });
    } else {
      alert('이 브라우저는 위치 정보를 지원하지 않습니다.');
    }
  </script>
</body>
</html>
