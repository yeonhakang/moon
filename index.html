<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>홍합 달 개기</title>
  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #ffeb3b;
    }
    .moon {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle at center, #000 60%, transparent 61%), #000;
      box-shadow: 0 0 40px 10px rgba(255, 235, 59, 0.4);
      margin-bottom: 1rem;
    }
    .info {
      line-height: 1.8;
      font-size: 1.1rem;
    }
    .label {
      color: #fdd835;
      font-weight: bold;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      .moon {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <h1>🌙 오늘의 달</h1>
  <div id="moonSVG" class="moon"></div>
  <div class="info">
    <div><span class="label">위상:</span> <span id="illumination">...</span></div>
    <div><span class="label">방향:</span> <span id="azimuth">...</span>°</div>
    <div><span class="label">고도:</span> <span id="altitude">...</span>°</div>
    <div><span class="label">출:</span> <span id="rise">...</span> / <span class="label">무닌:</span> <span id="set">...</span></div>
    <div><span class="label">설명:</span> <span id="meaning">...</span></div>
  </div>
  <script src="https://unpkg.com/suncalc"></script>
  <script>
    const moonDiv = document.getElementById('moonSVG');
    const illuminationText = document.getElementById('illumination');
    const azimuthText = document.getElementById('azimuth');
    const altitudeText = document.getElementById('altitude');
    const riseText = document.getElementById('rise');
    const setText = document.getElementById('set');
    const meaningText = document.getElementById('meaning');

    function getPhaseDescription(fraction) {
      const percent = (fraction * 100).toFixed(1);
      if (fraction < 0.02) return `🌑 삭 - 시작을 준비하세요.`;
      if (fraction < 0.25) return `🌒 초승달 - 기획의 씨아가 자라날까 때입니다.`;
      if (fraction < 0.49) return `🌓 상헌달 - 결정을 내는 시기입니다.`;
      if (fraction < 0.51) return `🌕 만 - 풍요의 가장 중요한 격려가 발생하는 것과 같습니다.`;
      if (fraction < 0.75) return `🌖 만하 - 거리를 조정하고 감정하는 시기입니다.`;
      if (fraction < 0.99) return `🌗 하헌달 - 나어내면서 자신을 다시 복기해보세요.`;
      return `🌑 그민 - 다시 바라보기 위한 마무리입니다.`;
    }

    function formatTime(date) {
      return date ? date.toTimeString().slice(0, 8) : '-';
    }

    function renderMoonPhase(fraction) {
      const percent = fraction * 100;
      let fade = percent > 50 ? (100 - percent) / 50 : percent / 50;
      fade = Math.max(fade, 0.05);

      const cx = 100, cy = 100, r = 90;
      let d = '';
      let svg = `<circle cx="${cx}" cy="${cy}" r="${r}" fill="#000" />`;

      if (percent <= 50) {
        d = `M ${cx} ${cy - r} A ${r} ${r} 0 1 1 ${cx} ${cy + r} A ${r * fade} ${r} 0 0 0 ${cx} ${cy - r}`;
      } else {
        d = `M ${cx} ${cy - r} A ${r} ${r} 0 1 0 ${cx} ${cy + r} A ${r * fade} ${r} 0 0 1 ${cx} ${cy - r}`;
      }
      svg += `<path d="${d}" fill="#ffeb3b" />`;
      moonDiv.innerHTML = `<svg width="200" height="200" viewBox="0 0 200 200">${svg}</svg>`;
    }

    function updateMoonData() {
      if (!navigator.geolocation) {
        alert('위치 정보를 가져올 수 없습니다.');
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        const now = new Date();
        const moon = SunCalc.getMoonIllumination(now);
        const posData = SunCalc.getMoonPosition(now, latitude, longitude);
        const times = SunCalc.getMoonTimes(now, latitude, longitude);

        illuminationText.textContent = (moon.fraction * 100).toFixed(1) + '%';
        azimuthText.textContent = (posData.azimuth * 180 / Math.PI).toFixed(1);
        altitudeText.textContent = (posData.altitude * 180 / Math.PI).toFixed(1);
        riseText.textContent = formatTime(times.rise);
        setText.textContent = formatTime(times.set);
        meaningText.textContent = getPhaseDescription(moon.fraction);

        renderMoonPhase(moon.fraction);
      }, err => {
        alert('위치 조회에 실패했습니다.');
      });
    }

    updateMoonData();
  </script>
</body>
</html>
