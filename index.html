<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¬ì˜ ëª¨ì–‘ ê´€ì°°í•˜ê¸°</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ë‹¬ì˜ ëª¨ì–‘ ê´€ì°°í•˜ê¸°</h1>
        </div>

        <div class="controls">
            <input type="date" id="dateSelector" class="date-input">
            <button id="viewToggle" class="button">ì›”ê°„ ë³´ê¸°</button>
        </div>

        <div id="dailyView" class="moon-display">
            <svg id="moonSVG" class="moon-svg moon-glow" viewBox="0 0 100 100"></svg>
            <div class="info">
                <h2 id="phaseText"></h2>
                <p id="dateText"></p>
                <div id="moonMeaning" class="moon-meaning"></div>
            </div>
        </div>

        <div class="location-info">
            <h3>ê´€ì¸¡ ì •ë³´</h3>
            <div id="locationStatus">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>

            <div class="observation-grid">
                <div class="info-card">
                    <h3>ë‹¬ ì¶œëª° ì‹œê°„</h3>
                    <div id="moonTimes"></div>
                </div>

                <div class="info-card">
                    <h3>í˜„ì¬ ë‹¬ ìœ„ì¹˜</h3>
                    <div id="moonPosition"></div>
                    <div class="compass" id="moonCompass">
                        <div class="compass-marker" id="moonMarker"></div>
                        <div id="compassDirections"></div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>ê´€ì¸¡ ì¡°ê±´</h3>
                    <div id="observationConditions"></div>
                </div>
            </div>
        </div>

        <div id="monthView" class="month-view" style="display: none"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.8.0/suncalc.min.js"></script>
    <script>
        function getMoonPhase(date) {
            const moonIllum = SunCalc.getMoonIllumination(date);
            return {
                phase: moonIllum.phase * 100,
                angle: moonIllum.angle,
                fraction: moonIllum.fraction
            };
        }

        function getMoonPhaseInfo(phase) {
            if (phase < 1 || phase > 99) return { name: "ì‚­ (New Moon)", meaning: "ë‹¬ì´ ë³´ì´ì§€ ì•ŠëŠ” ì‹œê¸°ì…ë‹ˆë‹¤." };
            if (phase < 7) return { name: "ì´ˆìŠ¹ë‹¬ ğŸŒ’", meaning: "ì‘ì€ ë¹›ì´ ì˜¤ë¥¸ìª½ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤." };
            if (phase < 23) return { name: "ì¦ëŒ€ ì´ˆìŠ¹ë‹¬", meaning: "ë‹¬ì˜ ì˜¤ë¥¸ìª½ì´ ì ì  ë°ì•„ì§‘ë‹ˆë‹¤." };
            if (phase < 27) return { name: "ìƒí˜„ë‹¬ ğŸŒ“", meaning: "ë‹¬ì˜ ì˜¤ë¥¸ìª½ì´ ë°˜ì¯¤ ë°ìŠµë‹ˆë‹¤." };
            if (phase < 48) return { name: "ìƒí˜„ ì´í›„", meaning: "ë‹¬ì´ ì ì  ë” ì°¨ì˜¤ë¦…ë‹ˆë‹¤." };
            if (phase < 52) return { name: "ë³´ë¦„ë‹¬ ğŸŒ•", meaning: "ë‹¬ì´ ì™„ì „íˆ ë°ìŠµë‹ˆë‹¤." };
            if (phase < 73) return { name: "ê¸°ìš¸ì–´ê°€ëŠ” ë‹¬", meaning: "ë‹¬ì˜ ì™¼ìª½ì´ ì„œì„œíˆ ì–´ë‘ì›Œì§‘ë‹ˆë‹¤." };
            if (phase < 77) return { name: "í•˜í˜„ë‹¬ ğŸŒ—", meaning: "ë‹¬ì˜ ì™¼ìª½ì´ ë°˜ì¯¤ ë°ìŠµë‹ˆë‹¤." };
            if (phase < 93) return { name: "ê¸°ìš¸ì–´ê°€ëŠ” ì´ˆìŠ¹ë‹¬", meaning: "ë‹¬ì˜ ë°ì€ ë¶€ë¶„ì´ ì ì  ì‚¬ë¼ì§‘ë‹ˆë‹¤." };
            return { name: "ê·¸ë¯ë‹¬ ğŸŒ˜", meaning: "ì™¼ìª½ì— ì‘ì€ ë¹›ì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤." };
        }

        function updateUI(date) {
            const moon = getMoonPhase(date);
            const info = getMoonPhaseInfo(moon.phase);

            document.getElementById("phaseText").textContent = info.name;
            document.getElementById("moonMeaning").textContent = info.meaning;
            document.getElementById("dateText").textContent = date.toLocaleDateString('ko-KR');

            document.getElementById("moonSVG").innerHTML = `<circle cx="50" cy="50" r="40" fill="white" opacity="${moon.fraction}" />`;
        }

        document.getElementById("dateSelector").addEventListener("change", (e) => {
            const selectedDate = new Date(e.target.value);
            updateUI(selectedDate);
        });

        document.addEventListener("DOMContentLoaded", () => {
            const today = new Date();
            document.getElementById("dateSelector").valueAsDate = today;
            updateUI(today);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    document.getElementById("locationStatus").textContent = `í˜„ì¬ ìœ„ì¹˜: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                });
            }
        });
    </script>
</body>
</html>
