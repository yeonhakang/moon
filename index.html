<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ë‹¬</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Pretendard', sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      color: #ffd54f;
    }
    .moon {
      width: 200px;
      height: 200px;
      margin: 20px auto;
      display: block;
    }
    .info {
      font-size: 1.2em;
      margin-top: 10px;
    }
    .label {
      color: #ffeb3b;
      font-weight: bold;
    }
    .desc {
      margin-top: 10px;
    }
    button {
      margin-top: 20px;
      background: #1976d2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 1em;
    }
    @media (max-width: 600px) {
      .moon {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸŒ™ ì˜¤ëŠ˜ì˜ ë‹¬</h1>
  <div id="moonContainer"></div>
  <div class="info" id="moonInfo"></div>
  <div class="desc" id="moonDesc"></div>
  <button onclick="updateMoon()">ë‹¤ì‹œ ê³„ì‚°</button>

  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  <script>
    function getMoonPhaseName(phase) {
      const names = [
        "ì‚° (New Moon)",
        "ì´ˆìŠ¹ë‹¬ (Waxing Crescent)",
        "ìƒí—Œë‹¬ (First Quarter)",
        "ë§Œìƒ (Waxing Gibbous)",
        "ë§ (Full Moon)",
        "ë§Œí•˜ (Waning Gibbous)",
        "í•˜í—Œë‹¬ (Last Quarter)",
        "ê·¸ë¯¼ë‹¬ (Waning Crescent)"
      ];
      return names[Math.round(phase * 8) % 8];
    }

    function getMoonSVG(phase) {
      const percent = (phase * 100).toFixed(1);
      const fade = phase <= 0.5 ? phase * 2 : (1 - phase) * 2;
      const shadow = 48 * fade;
      const svgContent = `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="moon">
          <defs>
            <radialGradient id="glow">
              <stop offset="30%" stop-color="#ffd54f" stop-opacity="0.9"/>
              <stop offset="100%" stop-color="#000" stop-opacity="0.1"/>
            </radialGradient>
          </defs>
          <circle cx="50" cy="50" r="48" fill="url(#glow)" />
          <circle cx="50" cy="50" r="40" fill="#ffd54f" />
          <path d="M 50 10
            A 40 40 0 1 1 50 90
            A ${shadow} 40 0 1 0 50 10
          " fill="#000" />
        </svg>
      `;
      console.log(svgContent);
      return svgContent;
    }

    function updateMoon() {
      const now = new Date();
      const moon = SunCalc.getMoonIllumination(now);
      const position = SunCalc.getMoonPosition(now, latitude, longitude);
      const times = SunCalc.getMoonTimes(now, latitude, longitude);

      const phasePercent = (moon.phase * 100).toFixed(1);
      const name = getMoonPhaseName(moon.phase);
      const azimuth = (position.azimuth * 180 / Math.PI + 360).toFixed(1);
      const altitude = (position.altitude * 180 / Math.PI).toFixed(1);

      const moonContainer = document.getElementById("moonContainer");
      const svgContent = getMoonSVG(moon.phase);
      moonContainer.innerHTML = svgContent;

      document.getElementById("moonInfo").innerHTML = `
        <div><span class="label">ìœ„ìƒ:</span> ${phasePercent}%</div>
        <div><span class="label">ë°©í–¥:</span> ${azimuth}Â°</div>
        <div><span class="label">ê³ ë„:</span> ${altitude}Â°</div>
        <div><span class="label">ì¶œ:</span> ${times.rise?.toLocaleTimeString() || "-"} /
        <span class="label">ë¬¼:</span> ${times.set?.toLocaleTimeString() || "-"}</div>
      `;

      document.getElementById("moonDesc").innerHTML = `
        <span class="label">ì„¤ëª…:</span> ğŸŒ‘ ${name} - ${getMoonPhaseMeaning(name)}
      `;
    }

    function getMoonPhaseMeaning(name) {
      const meanings = {
        "ì‚° (New Moon)": "ì‹œì‘ ì¤€ë¹„ì˜ ì‹œê¸°",
        "ì´ˆìŠ¹ë‹¬ (Waxing Crescent)": "ê¸°íšì˜ ì”¨ì•…ì´ ìë¥´ë‚˜ëŠ” ë•Œ",
        "ìƒí—Œë‹¬ (First Quarter)": "ë‚´ë©´ì˜ ì‹ ë¢°ê°€ ë†’ì•„ì§€ëŠ” ë•Œ",
        "ë§Œìƒ (Waxing Gibbous)": "ì •ì‹ ì  ì‹œê°ì´ ì‹œì‘ë˜ëŠ” ë•Œ",
        "ë§ (Full Moon)": "ì •ì ì— ë‹¬í•´ íš¨ìœ¨ì„ ì§€í‚¤ëŠ” ë•Œ",
        "ë§Œí•˜ (Waning Gibbous)": "ê°ì†Œì˜ ì‹œì‘ì„ ì¤€ë¹„",
        "í•˜í—Œë‹¬ (Last Quarter)": "ë“œë””ì–´ ë§‰ë°”ì§€ ì •ë„",
        "ê·¸ë¯¼ë‹¬ (Waning Crescent)": "ëì„ ì¡°ì ˆí•˜ë©° ì°¸ìœ¼ë©° ë‹¤ì‹œ"
      };
      return meanings[name] || "-";
    }

    let latitude = 37.5665;
    let longitude = 126.9780;

    navigator.geolocation.getCurrentPosition(
      pos => {
        latitude = pos.coords.latitude;
        longitude = pos.coords.longitude;
        updateMoon();
      },
      err => {
        console.warn("ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", err);
        updateMoon();
      }
    );
  </script>
</body>
</html>
