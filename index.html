<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>오늘의 달</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      color: #fff;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      padding: 1rem;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .moon {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      margin: 1rem auto;
      box-shadow: 0 0 30px rgba(255, 223, 0, 0.6);
    }

    .info {
      font-size: 1rem;
      line-height: 1.6;
    }

    .highlight {
      color: #ffde59;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      .moon {
        width: 150px;
        height: 150px;
      }
      .info {
        font-size: 0.9rem;
      }
    }
  </style>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable-dynamic-subset.css" rel="stylesheet" />
</head>
<body>
  <h1>🌙 오늘의 달</h1>
  <div class="moon" id="moon"></div>
  <div class="info" id="info"></div>

  <script>
    const moonDiv = document.getElementById('moon');
    const infoDiv = document.getElementById('info');

    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const now = new Date();

      const phaseData = SunCalc.getMoonIllumination(now);
      const posData = SunCalc.getMoonPosition(now, lat, lon);
      const times = SunCalc.getMoonTimes(now, lat, lon);

      const phase = (phaseData.phase * 100).toFixed(1);
      const azimuth = (posData.azimuth * 180 / Math.PI + 360) % 360;
      const altitude = (posData.altitude * 180 / Math.PI).toFixed(1);

      moonDiv.style.background = `radial-gradient(circle at ${phaseData.phase <= 0.5 ? 'left' : 'right'}, #ffdb4d ${Math.abs(0.5 - phaseData.phase) * 200}%, #000 ${Math.abs(0.5 - phaseData.phase) * 200}%)`;

      let label = '';
      if (phase < 1) label = '삭 🌑';
      else if (phase < 15) label = '초승달 🌒';
      else if (phase < 35) label = '상현달 🌓';
      else if (phase < 45) label = '만상 🌔';
      else if (phase <= 55) label = '보름달 🌕';
      else if (phase < 65) label = '만하 🌖';
      else if (phase < 85) label = '하현달 🌗';
      else if (phase < 99) label = '그믐달 🌘';
      else label = '삭 🌑';

      const description = {
        '삭 🌑': '달이 보이지 않는 시기입니다. 새로운 시작을 준비할 때입니다.',
        '초승달 🌒': '기회의 씨앗이 자라납니다.',
        '상현달 🌓': '긍정적인 에너지가 가득합니다.',
        '만상 🌔': '기대감이 커지는 시기입니다.',
        '보름달 🌕': '풍요와 충만함의 시기입니다.',
        '만하 🌖': '감사의 시간을 가져보세요.',
        '하현달 🌗': '지나온 날들을 돌아보세요.',
        '그믐달 🌘': '마무리와 정리의 시기입니다.'
      };

      infoDiv.innerHTML = `
        <p><span class="highlight">위상</span>: ${phase}%</p>
        <p><span class="highlight">방향</span>: ${azimuth.toFixed(1)}°</p>
        <p><span class="highlight">고도</span>: ${altitude}°</p>
        <p><span class="highlight">출</span>: ${times.rise ? times.rise.toLocaleTimeString() : '없음'} / 
           <span class="highlight">몰</span>: ${times.set ? times.set.toLocaleTimeString() : '없음'}</p>
        <p>🌓 <strong>${label}</strong> - ${description[label]}</p>
      `;
    }, err => {
      infoDiv.innerHTML = '<p>위치 정보를 불러오지 못했습니다.</p>';
    });
  </script>
</body>
</html>
