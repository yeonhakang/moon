<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í™í•© ë‹¬ ê°œê¸°</title>
  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #ffeb3b;
    }
    .moon {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle at center, #000 60%, transparent 61%), #000;
      box-shadow: 0 0 40px 10px rgba(255, 235, 59, 0.4);
      margin-bottom: 1rem;
    }
    .info {
      line-height: 1.8;
      font-size: 1.1rem;
    }
    .label {
      color: #fdd835;
      font-weight: bold;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      .moon {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸŒ™ ì˜¤ëŠ˜ì˜ ë‹¬</h1>
  <div id="moonSVG" class="moon"></div>
  <div class="info">
    <div><span class="label">ìœ„ìƒ:</span> <span id="illumination">...</span></div>
    <div><span class="label">ë°©í–¥:</span> <span id="azimuth">...</span>Â°</div>
    <div><span class="label">ê³ ë„:</span> <span id="altitude">...</span>Â°</div>
    <div><span class="label">ì¶œ:</span> <span id="rise">...</span> / <span class="label">ë¬´ë‹Œ:</span> <span id="set">...</span></div>
    <div><span class="label">ì„¤ëª…:</span> <span id="meaning">...</span></div>
  </div>
  <script src="https://unpkg.com/suncalc"></script>
  <script>
    const moonDiv = document.getElementById('moonSVG');
    const illuminationText = document.getElementById('illumination');
    const azimuthText = document.getElementById('azimuth');
    const altitudeText = document.getElementById('altitude');
    const riseText = document.getElementById('rise');
    const setText = document.getElementById('set');
    const meaningText = document.getElementById('meaning');

    function getPhaseDescription(fraction) {
      const percent = (fraction * 100).toFixed(1);
      if (fraction < 0.02) return `ğŸŒ‘ ì‚­ - ì‹œì‘ì„ ì¤€ë¹„í•˜ì„¸ìš”.`;
      if (fraction < 0.25) return `ğŸŒ’ ì´ˆìŠ¹ë‹¬ - ê¸°íšì˜ ì”¨ì•„ê°€ ìë¼ë‚ ê¹Œ ë•Œì…ë‹ˆë‹¤.`;
      if (fraction < 0.49) return `ğŸŒ“ ìƒí—Œë‹¬ - ê²°ì •ì„ ë‚´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.`;
      if (fraction < 0.51) return `ğŸŒ• ë§Œ - í’ìš”ì˜ ê°€ì¥ ì¤‘ìš”í•œ ê²©ë ¤ê°€ ë°œìƒí•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.`;
      if (fraction < 0.75) return `ğŸŒ– ë§Œí•˜ - ê±°ë¦¬ë¥¼ ì¡°ì •í•˜ê³  ê°ì •í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.`;
      if (fraction < 0.99) return `ğŸŒ— í•˜í—Œë‹¬ - ë‚˜ì–´ë‚´ë©´ì„œ ìì‹ ì„ ë‹¤ì‹œ ë³µê¸°í•´ë³´ì„¸ìš”.`;
      return `ğŸŒ‘ ê·¸ë¯¼ - ë‹¤ì‹œ ë°”ë¼ë³´ê¸° ìœ„í•œ ë§ˆë¬´ë¦¬ì…ë‹ˆë‹¤.`;
    }

    function formatTime(date) {
      return date ? date.toTimeString().slice(0, 8) : '-';
    }

    function renderMoonPhase(fraction) {
      const percent = fraction * 100;
      let fade = percent > 50 ? (100 - percent) / 50 : percent / 50;
      fade = Math.max(fade, 0.05);

      const cx = 100, cy = 100, r = 90;
      let d = '';
      let svg = `<circle cx="${cx}" cy="${cy}" r="${r}" fill="#000" />`;

      if (percent <= 50) {
        d = `M ${cx} ${cy - r} A ${r} ${r} 0 1 1 ${cx} ${cy + r} A ${r * fade} ${r} 0 0 0 ${cx} ${cy - r}`;
      } else {
        d = `M ${cx} ${cy - r} A ${r} ${r} 0 1 0 ${cx} ${cy + r} A ${r * fade} ${r} 0 0 1 ${cx} ${cy - r}`;
      }
      svg += `<path d="${d}" fill="#ffeb3b" />`;
      moonDiv.innerHTML = `<svg width="200" height="200" viewBox="0 0 200 200">${svg}</svg>`;
    }

    function updateMoonData() {
      if (!navigator.geolocation) {
        alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        const now = new Date();
        const moon = SunCalc.getMoonIllumination(now);
        const posData = SunCalc.getMoonPosition(now, latitude, longitude);
        const times = SunCalc.getMoonTimes(now, latitude, longitude);

        illuminationText.textContent = (moon.fraction * 100).toFixed(1) + '%';
        azimuthText.textContent = (posData.azimuth * 180 / Math.PI).toFixed(1);
        altitudeText.textContent = (posData.altitude * 180 / Math.PI).toFixed(1);
        riseText.textContent = formatTime(times.rise);
        setText.textContent = formatTime(times.set);
        meaningText.textContent = getPhaseDescription(moon.fraction);

        renderMoonPhase(moon.fraction);
      }, err => {
        alert('ìœ„ì¹˜ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      });
    }

    updateMoonData();
  </script>
</body>
</html>
