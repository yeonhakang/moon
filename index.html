<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>달 위상 관측기</title>
  <style>
    :root {
      --bg-color: #000000;
      --text-color: #ffffff;
      --accent-color: #fdd835;
      --card-bg: #121212;
      --font-main: 'Noto Sans KR', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: var(--font-main);
      padding: 20px;
    }

    h1, h2, h3 {
      color: var(--accent-color);
      margin-bottom: 10px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .moon-info {
      text-align: center;
      margin-top: 30px;
    }

    #moon-image {
      width: 200px;
      height: 200px;
      display: block;
      margin: 0 auto 10px;
      filter: drop-shadow(0 0 10px var(--accent-color));
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .card {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.05);
    }

    #month-view {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 30px;
    }

    .day-cell {
      background: #1f1f1f;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9em;
      color: var(--text-color);
    }

    .day-cell img {
      width: 50px;
      height: 50px;
      margin-top: 5px;
    }

    @media (max-width: 600px) {
      #moon-image {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>달 위상 관측기</h1>
    <input type="date" id="datePicker" />
    <div class="moon-info">
      <img id="moon-image" src="" alt="달 위상 이미지">
      <h2 id="phase-name"></h2>
      <p id="phase-description"></p>
    </div>
    <div class="info-grid">
      <div class="card">
        <h3>달 위치</h3>
        <div id="moon-position"></div>
      </div>
      <div class="card">
        <h3>달 출몰 시간</h3>
        <div id="moon-times"></div>
      </div>
    </div>
    <h2 style="margin-top: 40px">월간 보기</h2>
    <div id="month-view"></div>
  </div>
  <script src="https://unpkg.com/suncalc"></script>
  <script>
    const moonImages = [...Array(30).keys()].map(i => `./nasa_moon_phases/moon_${String(i + 1).padStart(2, '0')}.jpg`);

    const phaseDescriptions = [
      "완전한 암흑. 새로운 시작의 시기입니다.",
      "희미한 빛. 서서히 드러나는 가능성.",
      "조심스레 다가오는 시작.",
      "작지만 분명한 움직임.",
      "꿈틀거리는 새벽의 소망.",
      "감정의 발아. 내면의 각성.",
      "약속을 품은 어스름.",
      "무르익는 직감. 새로운 도전.",
      "반쯤 밝혀진 확신.",
      "상현. 정점에 향하는 발걸음.",
      "의지의 찬란함. 정진의 시기.",
      "중간점. 검토와 조율.",
      "보름에 가까운 충만함.",
      "거의 가득 찬 환희.",
      "보름달. 완성의 순간.",
      "서서히 줄어드는 채움.",
      "감사의 시간.",
      "내려놓음과 성찰.",
      "하현. 반대편을 바라보기.",
      "과거와 화해.",
      "정리의 기술.",
      "비워냄 속 자유.",
      "다시 어두워짐.",
      "잊혀짐 속 기억.",
      "마무리의 기술.",
      "어둠과 함께하는 신비.",
      "거의 다 사라짐.",
      "그믐. 침묵 속 기도.",
      "끝, 그리고 다시 시작.",
      "새로운 달이 다가옵니다."
    ];

    function updateMoon(date) {
      const moon = SunCalc.getMoonIllumination(date);
      const moonPos = SunCalc.getMoonPosition(date, latitude, longitude);
      const moonTimes = SunCalc.getMoonTimes(date, latitude, longitude);

      const phaseIndex = Math.round(moon.phase * 29); // 0~29
      document.getElementById('moon-image').src = moonImages[phaseIndex];
      document.getElementById('phase-name').textContent = `위상: ${(moon.phase * 100).toFixed(1)}%`;
      document.getElementById('phase-description').textContent = phaseDescriptions[phaseIndex];

      document.getElementById('moon-position').innerHTML = `고도: ${moonPos.altitude.toFixed(2)}°, 방위각: ${moonPos.azimuth.toFixed(2)}°`;
      document.getElementById('moon-times').innerHTML = `달 뜸: ${moonTimes.rise?.toLocaleTimeString() || '정보 없음'}<br>달 짐: ${moonTimes.set?.toLocaleTimeString() || '정보 없음'}`;
    }

    function buildMonthView(year, month) {
      const container = document.getElementById('month-view');
      container.innerHTML = '';
      const days = new Date(year, month + 1, 0).getDate();

      for (let i = 1; i <= days; i++) {
        const date = new Date(year, month, i);
        const moon = SunCalc.getMoonIllumination(date);
        const phaseIndex = Math.round(moon.phase * 29);

        const cell = document.createElement('div');
        cell.className = 'day-cell';
        cell.innerHTML = `<strong>${i}일</strong><br><img src="${moonImages[phaseIndex]}" alt="${i}일"><br>${(moon.phase * 100).toFixed(0)}%`;
        container.appendChild(cell);
      }
    }

    let latitude = 37.5665;
    let longitude = 126.9780;

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        latitude = pos.coords.latitude;
        longitude = pos.coords.longitude;
        const today = new Date();
        document.getElementById('datePicker').valueAsDate = today;
        updateMoon(today);
        buildMonthView(today.getFullYear(), today.getMonth());
      }, () => {
        const today = new Date();
        document.getElementById('datePicker').valueAsDate = today;
        updateMoon(today);
        buildMonthView(today.getFullYear(), today.getMonth());
      });
    }

    document.getElementById('datePicker').addEventListener('change', e => {
      const date = new Date(e.target.value);
      updateMoon(date);
      buildMonthView(date.getFullYear(), date.getMonth());
    });
  </script>
</body>
</html>
